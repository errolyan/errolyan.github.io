# ç¬¬19æœŸ ç‰ˆæœ¬æ§åˆ¶ä¸AIï¼šæ™ºèƒ½æäº¤ä¸ä»£ç å®¡æŸ¥

æ¬¢è¿å›åˆ°AIç¼–ç¨‹æ·±åº¦ä¸“ç ”ç³»åˆ—æ•™ç¨‹ï¼åœ¨ä¸Šä¸€æœŸä¸­ï¼Œæˆ‘ä»¬æ·±å…¥æ¢è®¨äº†å¦‚ä½•å°†AIé›†æˆåˆ°å¼€å‘ç¯å¢ƒä¸­ï¼Œå­¦ä¹ äº†IDEæ’ä»¶å¯¹æ¯”ã€è‡ªå®šä¹‰å·¥å…·é“¾é…ç½®ã€å¿«æ·é”®ä¼˜åŒ–ä»¥åŠå¤šå·¥å…·ååŒç­–ç•¥ã€‚æœ¬æœŸæˆ‘ä»¬å°†ç»§ç»­ç¬¬å…­ç« çš„å†…å®¹ï¼Œèšç„¦äºç‰ˆæœ¬æ§åˆ¶ä¸AIçš„ç»“åˆï¼Œå­¦ä¹ å¦‚ä½•åˆ©ç”¨AIè¾…åŠ©è¿›è¡Œæ™ºèƒ½æäº¤å’Œä»£ç å®¡æŸ¥ï¼Œæå‡å›¢é˜Ÿåä½œæ•ˆç‡ã€‚

## 6.2.1 AIè¾…åŠ©çš„æäº¤ä¿¡æ¯ç”Ÿæˆ

ç¼–å†™è§„èŒƒã€æ¸…æ™°çš„Gitæäº¤ä¿¡æ¯æ˜¯è‰¯å¥½å¼€å‘å®è·µçš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚AIå¯ä»¥å¸®åŠ©è‡ªåŠ¨ç”Ÿæˆç¬¦åˆè§„èŒƒçš„æäº¤ä¿¡æ¯ï¼ŒèŠ‚çœå¼€å‘è€…æ—¶é—´å¹¶æé«˜æäº¤å†å²çš„å¯è¯»æ€§ã€‚

### è‡ªåŠ¨ç”Ÿæˆæäº¤ä¿¡æ¯çš„æ–¹æ³•

**1. åŸºäºä»£ç å˜æ›´çš„æäº¤ä¿¡æ¯ç”Ÿæˆ**

ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨AIè‡ªåŠ¨ç”Ÿæˆæäº¤ä¿¡æ¯çš„Pythonè„šæœ¬ç¤ºä¾‹ï¼š

```python
#!/usr/bin/env python3
# ai_commit.py - ä½¿ç”¨AIè‡ªåŠ¨ç”ŸæˆGitæäº¤ä¿¡æ¯

import subprocess
import openai
import os
import sys
from datetime import datetime

# é…ç½®OpenAI APIå¯†é’¥
openai.api_key = os.environ.get("OPENAI_API_KEY")

def get_git_diff():
    """
    è·å–å½“å‰å·¥ä½œåŒºæœªæäº¤çš„ä»£ç å˜æ›´
    """
    try:
        # è·å–æš‚å­˜åŒºçš„å˜æ›´
        staged_diff = subprocess.check_output(
            ["git", "diff", "--staged"], 
            universal_newlines=True
        )
        
        # å¦‚æœæ²¡æœ‰æš‚å­˜åŒºå˜æ›´ï¼Œè·å–å·¥ä½œåŒºæ‰€æœ‰å˜æ›´
        if not staged_diff:
            staged_diff = subprocess.check_output(
                ["git", "diff"], 
                universal_newlines=True
            )
            if not staged_diff:
                print("æ²¡æœ‰æ£€æµ‹åˆ°ä»£ç å˜æ›´")
                sys.exit(1)
        
        return staged_diff
    except subprocess.CalledProcessError as e:
        print(f"è·å–Gitå˜æ›´å¤±è´¥: {e}")
        sys.exit(1)

def generate_commit_message(diff, max_length=50):
    """
    ä½¿ç”¨AIæ ¹æ®ä»£ç å˜æ›´ç”Ÿæˆæäº¤ä¿¡æ¯
    """
    # é™åˆ¶diffå¤§å°ï¼Œé¿å…è¶…å‡ºAPIé™åˆ¶
    max_diff_length = 4000
    if len(diff) > max_diff_length:
        diff = diff[:max_diff_length] + "\n[diffå†…å®¹è¿‡é•¿ï¼Œå·²æˆªæ–­]"
    
    prompt = f"""
è¯·æ ¹æ®ä»¥ä¸‹Gitä»£ç å˜æ›´ç”Ÿæˆä¸€ä¸ªç®€æ´ã€æè¿°æ€§çš„æäº¤ä¿¡æ¯ã€‚

è¦æ±‚ï¼š
1. ç¬¬ä¸€è¡Œä½œä¸ºä¸»é¢˜è¡Œï¼Œä¸è¶…è¿‡{max_length}ä¸ªå­—ç¬¦
2. å¦‚æœéœ€è¦ï¼Œç¬¬äºŒè¡Œç•™ç©º
3. åç»­è¡Œæä¾›æ›´è¯¦ç»†çš„å˜æ›´è¯´æ˜ï¼ˆå¦‚æœ‰å¿…è¦ï¼‰
4. ä½¿ç”¨ç¥ˆä½¿è¯­æ°”ï¼ˆä¾‹å¦‚"Add"è€Œä¸æ˜¯"Added"ï¼‰
5. ä¸»é¢˜è¡Œåº”å½“æ¸…æ™°æè¿°ä¸»è¦å˜æ›´å†…å®¹
6. é¿å…ä½¿ç”¨é€šç”¨æœ¯è¯­å¦‚"Update file.js"ï¼Œå°½å¯èƒ½æè¿°å…·ä½“å˜æ›´

ä»£ç å˜æ›´ï¼š
```diff
{diff}
```

è¯·ç›´æ¥æä¾›æäº¤ä¿¡æ¯ï¼Œä¸è¦æ·»åŠ å…¶ä»–è§£é‡Šã€‚
"""
    
    try:
        response = openai.ChatCompletion.create(
            model="gpt-4",
            messages=[
                {"role": "system", "content": "ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„å¼€å‘è€…ï¼Œæ“…é•¿ç¼–å†™æ¸…æ™°ã€è§„èŒƒçš„Gitæäº¤ä¿¡æ¯ã€‚"},
                {"role": "user", "content": prompt}
            ],
            temperature=0.3,  # è¾ƒä½çš„æ¸©åº¦å€¼ä½¿è¾“å‡ºæ›´åŠ ç¡®å®šæ€§
            max_tokens=200
        )
        
        return response.choices[0].message.content.strip()
    except Exception as e:
        print(f"ç”Ÿæˆæäº¤ä¿¡æ¯å¤±è´¥: {e}")
        sys.exit(1)

def commit_with_message(commit_message):
    """
    ä½¿ç”¨ç”Ÿæˆçš„æäº¤ä¿¡æ¯è¿›è¡ŒGitæäº¤
    """
    try:
        print("\nç”Ÿæˆçš„æäº¤ä¿¡æ¯:")
        print("=" * 72)
        print(commit_message)
        print("=" * 72)
        
        # ç¡®è®¤æ˜¯å¦ç»§ç»­
        confirm = input("\næ˜¯å¦ä½¿ç”¨æ­¤æäº¤ä¿¡æ¯ï¼Ÿ(y/n): ")
        if confirm.lower() != 'y':
            print("æäº¤å·²å–æ¶ˆ")
            sys.exit(0)
        
        # ä½¿ç”¨git commitå‘½ä»¤ï¼Œé€šè¿‡ç®¡é“ä¼ é€’æäº¤ä¿¡æ¯
        process = subprocess.Popen(
            ["git", "commit", "-F", "-"],
            stdin=subprocess.PIPE,
            universal_newlines=True
        )
        process.communicate(commit_message)
        
        if process.returncode == 0:
            print("\næäº¤æˆåŠŸï¼")
        else:
            print(f"\næäº¤å¤±è´¥ï¼Œè¿”å›ç : {process.returncode}")
            sys.exit(1)
            
    except Exception as e:
        print(f"æäº¤è¿‡ç¨‹ä¸­å‡ºé”™: {e}")
        sys.exit(1)

def main():
    # è·å–ä»£ç å˜æ›´
    print("æ­£åœ¨è·å–ä»£ç å˜æ›´...")
    diff = get_git_diff()
    
    # ç”Ÿæˆæäº¤ä¿¡æ¯
    print("æ­£åœ¨ç”Ÿæˆæäº¤ä¿¡æ¯...")
    commit_message = generate_commit_message(diff)
    
    # æ‰§è¡Œæäº¤
    commit_with_message(commit_message)

if __name__ == "__main__":
    main()
```

**2. ä¸Gité’©å­é›†æˆ**

æ‚¨å¯ä»¥å°†AIæäº¤ä¿¡æ¯ç”Ÿæˆå·¥å…·é›†æˆåˆ°Gitçš„pre-commité’©å­ä¸­ï¼š

```bash
#!/bin/bash
# .git/hooks/prepare-commit-msg

# ä»…åœ¨æ²¡æœ‰æä¾›æäº¤ä¿¡æ¯æ—¶æ‰§è¡Œ
if [ -z "$2" ]; then
    # æ£€æŸ¥æ˜¯å¦æœ‰AIæäº¤ä¿¡æ¯ç”Ÿæˆè„šæœ¬
    if [ -f "$(git rev-parse --show-toplevel)/scripts/ai_commit.py" ]; then
        # ç”Ÿæˆæäº¤ä¿¡æ¯å¹¶å†™å…¥åˆ°æäº¤ä¿¡æ¯æ–‡ä»¶
        python3 "$(git rev-parse --show-toplevel)/scripts/ai_commit.py" --generate-only > "$1"
        echo "å·²ä½¿ç”¨AIç”Ÿæˆæäº¤ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹å¹¶ç¡®è®¤"
    fi
fi
```

### æäº¤ä¿¡æ¯è§„èŒƒä¸å®šåˆ¶

ä¸åŒçš„å›¢é˜Ÿå¯èƒ½é‡‡ç”¨ä¸åŒçš„æäº¤ä¿¡æ¯è§„èŒƒï¼Œå¦‚Angularè§„èŒƒã€Conventional Commitsç­‰ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•å®šåˆ¶AIç”Ÿæˆç¬¦åˆç‰¹å®šè§„èŒƒçš„æäº¤ä¿¡æ¯ï¼š

**Conventional Commitsè§„èŒƒç”Ÿæˆ**

```python
def generate_conventional_commit_message(diff):
    """
    ç”Ÿæˆç¬¦åˆConventional Commitsè§„èŒƒçš„æäº¤ä¿¡æ¯
    æ ¼å¼: <type>[optional scope]: <description>
    <BLANK LINE>
    [optional body]
    <BLANK LINE>
    [optional footer(s)]
    """
    prompt = f"""
è¯·æ ¹æ®ä»¥ä¸‹Gitä»£ç å˜æ›´ç”Ÿæˆä¸€ä¸ªç¬¦åˆConventional Commitsè§„èŒƒçš„æäº¤ä¿¡æ¯ã€‚

è§„èŒƒè¦æ±‚ï¼š
1. ç¬¬ä¸€è¡Œæ ¼å¼ä¸º <type>[optional scope]: <description>
   - type: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert
   - scope: å¯é€‰ï¼Œè¡¨ç¤ºå½±å“çš„æ¨¡å—èŒƒå›´
   - description: ç®€çŸ­æè¿°ï¼ˆä¸è¶…è¿‡50å­—ç¬¦ï¼‰
2. å¦‚æœéœ€è¦ï¼Œç¬¬äºŒè¡Œç•™ç©º
3. åç»­è¡Œæä¾›æ›´è¯¦ç»†çš„å˜æ›´è¯´æ˜ï¼ˆbodyï¼‰
4. å¦‚æœæœ‰ç ´åæ€§å˜æ›´æˆ–å…³é—­issuesï¼Œåœ¨footerä¸­è¯´æ˜

ä»£ç å˜æ›´ï¼š
```diff
{diff}
```

è¯·ç›´æ¥æä¾›æäº¤ä¿¡æ¯ï¼Œä¸è¦æ·»åŠ å…¶ä»–è§£é‡Šã€‚
"""
    
    # è°ƒç”¨AI APIç”Ÿæˆæäº¤ä¿¡æ¯
    # ...
```

### æ™ºèƒ½æäº¤å†å²åˆ†æ

é™¤äº†ç”Ÿæˆæ–°çš„æäº¤ä¿¡æ¯ï¼ŒAIè¿˜å¯ä»¥å¸®åŠ©åˆ†æå’Œæ€»ç»“æäº¤å†å²ï¼Œä¸ºä»£ç å®¡æŸ¥å’Œé¡¹ç›®ç®¡ç†æä¾›æœ‰ä»·å€¼çš„æ´å¯Ÿï¼š

```python
def analyze_commit_history(days=7):
    """
    åˆ†ææœ€è¿‘å‡ å¤©çš„æäº¤å†å²å¹¶ç”Ÿæˆæ€»ç»“æŠ¥å‘Š
    """
    # è·å–æœ€è¿‘å‡ å¤©çš„æäº¤å†å²
    try:
        commits = subprocess.check_output(
            ["git", "log", f"--since={days}.days", "--pretty=format:%H|%an|%ae|%at|%s|%b"],
            universal_newlines=True
        )
        
        # æŒ‰æäº¤è€…åˆ†ç»„æäº¤
        author_commits = {}
        for commit in commits.strip().split('\n'):
            if not commit:
                continue
            
            parts = commit.split('|', 5)
            if len(parts) < 6:
                continue
                
            sha, author, email, timestamp, subject, body = parts
            
            if author not in author_commits:
                author_commits[author] = []
            
            author_commits[author].append({
                'sha': sha,
                'timestamp': datetime.fromtimestamp(int(timestamp)),
                'subject': subject,
                'body': body
            })
        
        # ä½¿ç”¨AIç”Ÿæˆæ€»ç»“æŠ¥å‘Š
        report_prompt = f"""
è¯·åˆ†æä»¥ä¸‹Gitæäº¤å†å²æ•°æ®ï¼Œå¹¶ç”Ÿæˆä¸€ä»½ç»“æ„åŒ–çš„é¡¹ç›®æ´»åŠ¨æŠ¥å‘Šã€‚

æ•°æ®åŒ…å«è¿‡å»{days}å¤©å†…çš„æäº¤ï¼ŒæŒ‰ä½œè€…åˆ†ç»„ï¼š

{author_commits}

æŠ¥å‘Šåº”åŒ…æ‹¬ï¼š
1. æ€»ä½“æ´»åŠ¨æ¦‚è§ˆï¼ˆæäº¤æ€»æ•°ã€ä½œè€…æ•°ç­‰ï¼‰
2. æ¯ä½ä½œè€…çš„ä¸»è¦è´¡çŒ®é¢†åŸŸå’Œå·¥ä½œé‡ç‚¹
3. å¯èƒ½çš„é¡¹ç›®è¶‹åŠ¿æˆ–æ¨¡å¼
4. å€¼å¾—æ³¨æ„çš„é‡è¦å˜æ›´
5. å¯¹é¡¹ç›®è¿›å±•çš„ç®€è¦è¯„ä¼°

è¯·ä½¿ç”¨ä¸“ä¸šä½†å‹å¥½çš„è¯­è¨€ï¼Œå¹¶å°†é‡ç‚¹æ”¾åœ¨æœ‰æ„ä¹‰çš„æ´å¯Ÿä¸Šï¼Œè€Œéç®€å•çš„æ•°æ®å¤è¿°ã€‚
"""
        
        # è°ƒç”¨AI APIç”ŸæˆæŠ¥å‘Š
        # ...
        
    except Exception as e:
        print(f"åˆ†ææäº¤å†å²å¤±è´¥: {e}")
        return None
```

## 6.2.2 æ™ºèƒ½ä»£ç å·®å¼‚åˆ†æ

AIå¯ä»¥å¸®åŠ©å¼€å‘è€…æ›´æ™ºèƒ½åœ°åˆ†æä»£ç å·®å¼‚ï¼Œå¿«é€Ÿç†è§£å˜æ›´çš„æ„å›¾å’Œå½±å“ï¼Œå°¤å…¶åœ¨å¤„ç†å¤§å‹ä»£ç åº“æˆ–å¤æ‚å˜æ›´æ—¶éå¸¸æœ‰ä»·å€¼ã€‚

### ä»£ç å·®å¼‚çš„æ™ºèƒ½è§£é‡Š

ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨AIåˆ†æä»£ç å·®å¼‚å¹¶ç”Ÿæˆè§£é‡Šçš„å·¥å…·ç¤ºä¾‹ï¼š

```python
#!/usr/bin/env python3
# ai_diff_analyzer.py - ä½¿ç”¨AIåˆ†æå’Œè§£é‡ŠGitä»£ç å·®å¼‚

import subprocess
import openai
import os
import sys
from typing import List, Dict, Any

def get_git_diff_for_commit(commit_hash: str) -> str:
    """
    è·å–æŒ‡å®šæäº¤çš„ä»£ç å·®å¼‚
    """
    try:
        # è·å–æŒ‡å®šæäº¤ä¸å…¶çˆ¶æäº¤ä¹‹é—´çš„å·®å¼‚
        diff = subprocess.check_output(
            ["git", "show", commit_hash, "-p"],
            universal_newlines=True
        )
        return diff
    except subprocess.CalledProcessError as e:
        print(f"è·å–æäº¤å·®å¼‚å¤±è´¥: {e}")
        sys.exit(1)

def get_git_diff_between_commits(commit1: str, commit2: str) -> str:
    """
    è·å–ä¸¤ä¸ªæäº¤ä¹‹é—´çš„ä»£ç å·®å¼‚
    """
    try:
        diff = subprocess.check_output(
            ["git", "diff", commit1, commit2, "-p"],
            universal_newlines=True
        )
        return diff
    except subprocess.CalledProcessError as e:
        print(f"è·å–æäº¤é—´å·®å¼‚å¤±è´¥: {e}")
        sys.exit(1)

def analyze_code_diff(diff: str, context: Dict[str, Any] = None) -> str:
    """
    ä½¿ç”¨AIåˆ†æä»£ç å·®å¼‚å¹¶ç”Ÿæˆè§£é‡Š
    """
    # é™åˆ¶diffå¤§å°
    max_diff_length = 5000
    if len(diff) > max_diff_length:
        diff = diff[:max_diff_length] + "\n[diffå†…å®¹è¿‡é•¿ï¼Œå·²æˆªæ–­]"
    
    # æ„å»ºä¸Šä¸‹æ–‡ä¿¡æ¯
    context_str = ""
    if context:
        context_str = "\nç›¸å…³ä¸Šä¸‹æ–‡ä¿¡æ¯:\n"
        for key, value in context.items():
            context_str += f"- {key}: {value}\n"
    
    prompt = f"""
è¯·åˆ†æä»¥ä¸‹ä»£ç å·®å¼‚ï¼Œå¹¶æä¾›è¯¦ç»†è§£é‡Šï¼š

```diff
{diff}
```

{context_str}

è¯·æä¾›ä»¥ä¸‹å†…å®¹ï¼š
1. å˜æ›´çš„æ€»ä½“ç›®çš„å’Œæ„å›¾
2. ä¸»è¦ä¿®æ”¹çš„åŠŸèƒ½æˆ–ç»„ä»¶
3. å¯èƒ½çš„æ€§èƒ½æˆ–å®‰å…¨å½±å“
4. æ½œåœ¨çš„é£é™©æˆ–éœ€è¦æ³¨æ„çš„é—®é¢˜
5. å˜æ›´æ˜¯å¦è§£å†³äº†ç‰¹å®šé—®é¢˜æˆ–å®ç°äº†ç‰¹å®šåŠŸèƒ½

è¯·ä½¿ç”¨æ¸…æ™°ã€ä¸“ä¸šçš„è¯­è¨€ï¼Œé€‚åˆå¼€å‘å›¢é˜Ÿé˜…è¯»å’Œç†è§£ã€‚
"""
    
    try:
        response = openai.ChatCompletion.create(
            model="gpt-4",
            messages=[
                {"role": "system", "content": "ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„è½¯ä»¶æ¶æ„å¸ˆå’Œä»£ç å®¡æŸ¥ä¸“å®¶ï¼Œæ“…é•¿åˆ†æä»£ç å˜æ›´å¹¶æä¾›æ·±å…¥çš„æŠ€æœ¯è§è§£ã€‚"},
                {"role": "user", "content": prompt}
            ],
            temperature=0.3,
            max_tokens=800
        )
        
        return response.choices[0].message.content.strip()
    except Exception as e:
        print(f"åˆ†æä»£ç å·®å¼‚å¤±è´¥: {e}")
        sys.exit(1)

def generate_impact_summary(diff: str) -> str:
    """
    ç”Ÿæˆå˜æ›´å½±å“æ‘˜è¦ï¼Œé€‚åˆåœ¨ä»£ç å®¡æŸ¥ä¸­ä½¿ç”¨
    """
    prompt = f"""
è¯·ä¸ºä»¥ä¸‹ä»£ç å·®å¼‚ç”Ÿæˆä¸€ä»½ç®€æ´çš„å˜æ›´å½±å“æ‘˜è¦ï¼Œç”¨äºä»£ç å®¡æŸ¥ï¼š

```diff
{diff}
```

è¯·æä¾›ï¼š
1. 2-3å¥è¯çš„å˜æ›´ç›®çš„æ€»ç»“
2. å˜æ›´å½±å“çš„ä¸»è¦ç»„ä»¶æˆ–åŠŸèƒ½
3. å¯èƒ½çš„å‘åå…¼å®¹æ€§é—®é¢˜ï¼ˆå¦‚é€‚ç”¨ï¼‰
4. æ¨èçš„æµ‹è¯•é‡ç‚¹
5. ä»£ç å®¡æŸ¥ä¸­éœ€è¦ç‰¹åˆ«å…³æ³¨çš„éƒ¨åˆ†

è¯·ä¿æŒå›ç­”ç²¾ç®€ï¼Œæ¯éƒ¨åˆ†æœ€å¤š2å¥è¯ã€‚
"""
    
    # è°ƒç”¨AI APIç”Ÿæˆæ‘˜è¦
    # ...

def main():
    # è§£æå‘½ä»¤è¡Œå‚æ•°
    if len(sys.argv) < 2:
        print("ä½¿ç”¨æ–¹æ³•:")
        print("  åˆ†æå•ä¸ªæäº¤: python ai_diff_analyzer.py commit <commit-hash>")
        print("  åˆ†æä¸¤ä¸ªæäº¤é—´å·®å¼‚: python ai_diff_analyzer.py compare <commit1> <commit2>")
        print("  åˆ†ææœªæäº¤çš„å˜æ›´: python ai_diff_analyzer.py staged")
        sys.exit(1)
    
    command = sys.argv[1]
    
    if command == "commit" and len(sys.argv) == 3:
        commit_hash = sys.argv[2]
        diff = get_git_diff_for_commit(commit_hash)
        
    elif command == "compare" and len(sys.argv) == 4:
        commit1 = sys.argv[2]
        commit2 = sys.argv[3]
        diff = get_git_diff_between_commits(commit1, commit2)
        
    elif command == "staged":
        # è·å–æš‚å­˜åŒºçš„å˜æ›´
        try:
            diff = subprocess.check_output(
                ["git", "diff", "--staged"],
                universal_newlines=True
            )
            if not diff:
                print("æš‚å­˜åŒºæ²¡æœ‰å˜æ›´")
                sys.exit(1)
        except subprocess.CalledProcessError as e:
            print(f"è·å–æš‚å­˜åŒºå˜æ›´å¤±è´¥: {e}")
            sys.exit(1)
    
    else:
        print("æ— æ•ˆçš„å‘½ä»¤å‚æ•°")
        sys.exit(1)
    
    # åˆ†æå·®å¼‚
    print("æ­£åœ¨åˆ†æä»£ç å·®å¼‚...")
    analysis = analyze_code_diff(diff)
    
    print("\nä»£ç å·®å¼‚åˆ†æç»“æœ:")
    print("=" * 80)
    print(analysis)
    print("=" * 80)
    
    # ç”Ÿæˆå½±å“æ‘˜è¦
    impact_summary = generate_impact_summary(diff)
    
    print("\nå˜æ›´å½±å“æ‘˜è¦:")
    print("=" * 80)
    print(impact_summary)
    print("=" * 80)

if __name__ == "__main__":
    # è®¾ç½®OpenAI APIå¯†é’¥
    openai.api_key = os.environ.get("OPENAI_API_KEY")
    if not openai.api_key:
        print("é”™è¯¯: æœªè®¾ç½®OPENAI_API_KEYç¯å¢ƒå˜é‡")
        sys.exit(1)
    
    main()
```

### å˜æ›´æ¨¡å¼è¯†åˆ«ä¸åˆ†ç±»

AIå¯ä»¥è¯†åˆ«ä»£ç å˜æ›´ä¸­çš„æ¨¡å¼ï¼Œè‡ªåŠ¨åˆ†ç±»å˜æ›´ç±»å‹ï¼Œå¹¶æä¾›é’ˆå¯¹æ€§çš„å»ºè®®ï¼š

```python
def categorize_code_changes(diff: str) -> Dict[str, List[str]]:
    """
    å¯¹ä»£ç å˜æ›´è¿›è¡Œåˆ†ç±»
    è¿”å›ä¸åŒç±»å‹å˜æ›´çš„æ–‡ä»¶åˆ—è¡¨
    """
    prompt = f"""
è¯·åˆ†æä»¥ä¸‹ä»£ç å·®å¼‚ï¼Œå°†å˜æ›´çš„æ–‡ä»¶æŒ‰ä»¥ä¸‹ç±»åˆ«è¿›è¡Œåˆ†ç±»ï¼š

```diff
{diff}
```

ç±»åˆ«åŒ…æ‹¬ï¼š
1. åŠŸèƒ½æ–°å¢ (features) - æ·»åŠ æ–°åŠŸèƒ½æˆ–API
2. é”™è¯¯ä¿®å¤ (fixes) - ä¿®å¤bugæˆ–é”™è¯¯
3. ä»£ç é‡æ„ (refactoring) - ä»£ç ç»“æ„æ”¹å˜ä½†åŠŸèƒ½ä¸å˜
4. æ€§èƒ½ä¼˜åŒ– (performance) - æé«˜ä»£ç æ‰§è¡Œæ•ˆç‡
5. æ–‡æ¡£æ›´æ–° (documentation) - ä»…æ›´æ–°æ³¨é‡Šæˆ–æ–‡æ¡£
6. æµ‹è¯•ç›¸å…³ (testing) - æ·»åŠ æˆ–ä¿®æ”¹æµ‹è¯•ä»£ç 
7. é…ç½®å˜æ›´ (configuration) - ä¿®æ”¹é…ç½®æ–‡ä»¶
8. æ ·å¼/æ ¼å¼è°ƒæ•´ (style) - ä»…æ”¹å˜ä»£ç é£æ ¼æˆ–æ ¼å¼

è¯·è¿”å›ä¸€ä¸ªJSONå¯¹è±¡ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š
{
  "features": ["æ–‡ä»¶è·¯å¾„1", "æ–‡ä»¶è·¯å¾„2"...],
  "fixes": [...],
  "refactoring": [...],
  "performance": [...],
  "documentation": [...],
  "testing": [...],
  "configuration": [...],
  "style": [...],
  "unclassified": [...] // æ— æ³•æ˜ç¡®åˆ†ç±»çš„æ–‡ä»¶
}

è¯·ç¡®ä¿æ¯ä¸ªå˜æ›´çš„æ–‡ä»¶åªå±äºä¸€ä¸ªç±»åˆ«ï¼Œå¦‚æœä¸€ä¸ªæ–‡ä»¶æœ‰å¤šç§ç±»å‹çš„å˜æ›´ï¼Œè¯·é€‰æ‹©ä¸»è¦çš„å˜æ›´ç±»å‹ã€‚
"""
    
    # è°ƒç”¨AI APIè¿›è¡Œåˆ†ç±»
    # ...
```

### ä¸Pull Requesté›†æˆ

å°†AIå·®å¼‚åˆ†æé›†æˆåˆ°Pull Requestæµç¨‹ä¸­ï¼Œå¯ä»¥è‡ªåŠ¨åŒ–ç”Ÿæˆå˜æ›´è¯´æ˜å’Œå»ºè®®ï¼š

```javascript
// GitHub Actionå·¥ä½œæµç¤ºä¾‹ - ai-pr-analysis.yml

name: AI PR Analysis

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  analyze:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
          
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
          
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install openai
          
      - name: Generate PR diff
        run: |
          git diff origin/${{ github.base_ref }}..origin/${{ github.head_ref }} > pr_diff.txt
          
      - name: Analyze diff with AI
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          python scripts/ai_pr_analyzer.py pr_diff.txt > ai_analysis.md
          
      - name: Add analysis as PR comment
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const fs = require('fs');
            const analysis = fs.readFileSync('ai_analysis.md', 'utf8');
            
            // è·å–PRä¿¡æ¯
            const prNumber = context.issue.number;
            
            // æ·»åŠ è¯„è®º
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: prNumber,
              body: `## ğŸ¤– AIä»£ç åˆ†æç»“æœ\n\n${analysis}`
            });
```

## 6.2.3 è‡ªåŠ¨åŒ–ä»£ç å®¡æŸ¥æµç¨‹

AIå¯ä»¥æ˜¾è‘—å¢å¼ºä»£ç å®¡æŸ¥æµç¨‹ï¼Œè‡ªåŠ¨åŒ–ä¸€äº›å¸¸è§„çš„å®¡æŸ¥ä»»åŠ¡ï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿä¸“æ³¨äºæ›´å¤æ‚çš„æŠ€æœ¯å’Œæ¶æ„å†³ç­–ã€‚

### AIä»£ç å®¡æŸ¥å·¥å…·é›†æˆ

ä»¥ä¸‹æ˜¯ä¸€ä¸ªé›†æˆAIåˆ°ä»£ç å®¡æŸ¥æµç¨‹çš„Pythonè„šæœ¬ç¤ºä¾‹ï¼š

```python
#!/usr/bin/env python3
# ai_code_reviewer.py - ä½¿ç”¨AIè¿›è¡Œè‡ªåŠ¨åŒ–ä»£ç å®¡æŸ¥

import openai
import os
import sys
import subprocess
import json
from typing import List, Dict, Any

def get_changed_files(commit_range: str) -> List[str]:
    """
    è·å–æŒ‡å®šæäº¤èŒƒå›´å†…å˜æ›´çš„æ–‡ä»¶åˆ—è¡¨
    """
    try:
        files = subprocess.check_output(
            ["git", "diff", commit_range, "--name-only"],
            universal_newlines=True
        ).strip().split('\n')
        return [f for f in files if f]
    except subprocess.CalledProcessError as e:
        print(f"è·å–å˜æ›´æ–‡ä»¶åˆ—è¡¨å¤±è´¥: {e}")
        sys.exit(1)

def get_file_content(file_path: str, commit: str = None) -> str:
    """
    è·å–æ–‡ä»¶å†…å®¹
    """
    try:
        if commit:
            # è·å–æŒ‡å®šæäº¤ä¸­çš„æ–‡ä»¶å†…å®¹
            content = subprocess.check_output(
                ["git", "show", f"{commit}:{file_path}"],
                universal_newlines=True
            )
        else:
            # è·å–å½“å‰å·¥ä½œåŒºçš„æ–‡ä»¶å†…å®¹
            with open(file_path, 'r') as f:
                content = f.read()
        return content
    except Exception as e:
        print(f"è·å–æ–‡ä»¶å†…å®¹å¤±è´¥ {file_path}: {e}")
        return ""

def analyze_file_with_ai(file_path: str, content: str, language: str = None) -> Dict[str, Any]:
    """
    ä½¿ç”¨AIåˆ†ææ–‡ä»¶å†…å®¹ï¼Œæä¾›ä»£ç å®¡æŸ¥æ„è§
    """
    if not language:
        # æ ¹æ®æ–‡ä»¶æ‰©å±•åæ¨æ–­ç¼–ç¨‹è¯­è¨€
        ext = os.path.splitext(file_path)[1].lower()
        language_map = {
            '.py': 'Python', '.js': 'JavaScript', '.ts': 'TypeScript',
            '.jsx': 'JSX', '.tsx': 'TSX', '.java': 'Java',
            '.cpp': 'C++', '.c': 'C', '.cs': 'C#', '.go': 'Go',
            '.rb': 'Ruby', '.php': 'PHP', '.swift': 'Swift',
            '.kt': 'Kotlin', '.rs': 'Rust', '.html': 'HTML',
            '.css': 'CSS', '.scss': 'SCSS', '.sass': 'SASS',
            '.json': 'JSON', '.yml': 'YAML', '.yaml': 'YAML',
            '.md': 'Markdown'
        }
        language = language_map.get(ext, 'é€šç”¨ä»£ç ')
    
    # é™åˆ¶æ–‡ä»¶å¤§å°ï¼Œé¿å…è¶…å‡ºAPIé™åˆ¶
    max_content_length = 5000
    if len(content) > max_content_length:
        content = content[:max_content_length] + "\n[æ–‡ä»¶å†…å®¹è¿‡é•¿ï¼Œå·²æˆªæ–­]"
    
    prompt = f"""
è¯·ä½œä¸ºä¸€ä½ç»éªŒä¸°å¯Œçš„ä»£ç å®¡æŸ¥ä¸“å®¶ï¼Œå®¡æŸ¥ä»¥ä¸‹{language}ä»£ç æ–‡ä»¶ï¼š

æ–‡ä»¶è·¯å¾„: {file_path}

```
{content}
```

è¯·æä¾›ä»¥ä¸‹æ–¹é¢çš„å®¡æŸ¥æ„è§ï¼š

1. ä»£ç è´¨é‡å’Œå¯è¯»æ€§é—®é¢˜
2. æ½œåœ¨çš„é”™è¯¯æˆ–bug
3. æ€§èƒ½ä¼˜åŒ–å»ºè®®
4. å®‰å…¨æ€§é—®é¢˜
5. æœ€ä½³å®è·µè¿åæƒ…å†µ
6. å¯èƒ½çš„é‡æ„å»ºè®®

è¯·æŒ‰ä¸¥é‡ç¨‹åº¦åˆ†ç±»æ‚¨çš„è¯„è®ºï¼ˆä¸¥é‡ã€ä¸­ç­‰ã€è½»å¾®ï¼‰ï¼Œå¹¶ä¸ºæ¯æ¡è¯„è®ºæä¾›å…·ä½“çš„æ”¹è¿›å»ºè®®ã€‚

è¯·è¿”å›ä¸€ä¸ªç»“æ„åŒ–çš„JSONå¯¹è±¡ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š
{
  "file_path": "{file_path}",
  "language": "{language}",
  "severity_counts": {"critical": 0, "medium": 0, "minor": 0},
  "comments": [
    {
      "severity": "critical|medium|minor",
      "line": [start_line, end_line], // å¦‚æœé€‚ç”¨ï¼Œå¦åˆ™ä¸ºnull
      "title": "ç®€çŸ­çš„è¯„è®ºæ ‡é¢˜",
      "description": "è¯¦ç»†çš„é—®é¢˜æè¿°",
      "suggestion": "å…·ä½“çš„æ”¹è¿›å»ºè®®"
    }
  ],
  "overall_assessment": {
    "quality_score": 0-100,
    "summary": "æ€»ä½“è¯„ä»·",
    "key_strengths": ["ä¼˜ç‚¹1", "ä¼˜ç‚¹2"],
    "key_improvements": ["æ”¹è¿›ç‚¹1", "æ”¹è¿›ç‚¹2"]
  }
}

è¯·ç¡®ä¿æ‚¨çš„å›ç­”æ˜¯æœ‰æ•ˆçš„JSONæ ¼å¼ï¼Œä¸è¦åŒ…å«JSONä¹‹å¤–çš„å†…å®¹ã€‚
"""
    
    try:
        response = openai.ChatCompletion.create(
            model="gpt-4",
            messages=[
                {"role": "system", "content": "ä½ æ˜¯ä¸€ä½èµ„æ·±çš„è½¯ä»¶å·¥ç¨‹å¸ˆå’Œä»£ç å®¡æŸ¥ä¸“å®¶ï¼Œæ“…é•¿å¤šç§ç¼–ç¨‹è¯­è¨€ï¼Œæ³¨é‡ä»£ç è´¨é‡ã€æ€§èƒ½ã€å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚"},
                {"role": "user", "content": prompt}
            ],
            temperature=0.2,  # è¾ƒä½çš„æ¸©åº¦å€¼ä½¿è¾“å‡ºæ›´åŠ ç¡®å®šæ€§
            response_format={"type": "json_object"}
        )
        
        # è§£æJSONå“åº”
        review_data = json.loads(response.choices[0].message.content)
        return review_data
    except Exception as e:
        print(f"åˆ†ææ–‡ä»¶å¤±è´¥ {file_path}: {e}")
        return {
            "file_path": file_path,
            "language": language,
            "severity_counts": {"critical": 0, "medium": 0, "minor": 0},
            "comments": [],
            "overall_assessment": {
                "quality_score": 0,
                "summary": "åˆ†æå¤±è´¥",
                "key_strengths": [],
                "key_improvements": []
            }
        }

def generate_review_report(reviews: List[Dict[str, Any]]) -> str:
    """
    ç”Ÿæˆå®Œæ•´çš„ä»£ç å®¡æŸ¥æŠ¥å‘Š
    """
    # ç»Ÿè®¡æ€»è¯„è®ºæ•°
    total_critical = sum(r.get("severity_counts", {}).get("critical", 0) for r in reviews)
    total_medium = sum(r.get("severity_counts", {}).get("medium", 0) for r in reviews)
    total_minor = sum(r.get("severity_counts", {}).get("minor", 0) for r in reviews)
    
    # ç”ŸæˆMarkdownæŠ¥å‘Š
    report = "# AIä»£ç å®¡æŸ¥æŠ¥å‘Š\n\n"
    report += "## æ€»ä½“ç»Ÿè®¡\n\n"
    report += f"- æ–‡ä»¶æ€»æ•°: {len(reviews)}\n"
    report += f"- ä¸¥é‡é—®é¢˜: {total_critical}\n"
    report += f"- ä¸­ç­‰é—®é¢˜: {total_medium}\n"
    report += f"- è½»å¾®é—®é¢˜: {total_minor}\n"
    report += f"- é—®é¢˜æ€»æ•°: {total_critical + total_medium + total_minor}\n\n"
    
    # æŒ‰æ–‡ä»¶åˆ†ç±»çš„è¯„è®º
    report += "## è¯¦ç»†è¯„è®º\n\n"
    
    # å…ˆæ˜¾ç¤ºæœ‰ä¸¥é‡é—®é¢˜çš„æ–‡ä»¶
    for review in sorted(reviews, key=lambda x: (-x.get("severity_counts", {}).get("critical", 0), 
                                               -x.get("severity_counts", {}).get("medium", 0))):
        comments = review.get("comments", [])
        if not comments:
            continue
        
        report += f"### {review.get('file_path')} (è¯„åˆ†: {review.get('overall_assessment', {}).get('quality_score', 0)}/100)\n\n"
        report += f"**{review.get('overall_assessment', {}).get('summary', '')}**\n\n"
        
        # æ˜¾ç¤ºä¼˜åŠ¿
        strengths = review.get('overall_assessment', {}).get('key_strengths', [])
        if strengths:
            report += "**ä¼˜åŠ¿:**\n"
            for strength in strengths:
                report += f"- {strength}\n"
            report += "\n"
        
        # æ˜¾ç¤ºæ”¹è¿›ç‚¹
        improvements = review.get('overall_assessment', {}).get('key_improvements', [])
        if improvements:
            report += "**éœ€è¦æ”¹è¿›çš„åœ°æ–¹:**\n"
            for improvement in improvements:
                report += f"- {improvement}\n"
            report += "\n"
        
        # æ˜¾ç¤ºè¯„è®º
        for comment in comments:
            severity_emoji = {"critical": "ğŸ”´", "medium": "ğŸŸ ", "minor": "ğŸŸ¡"}.get(comment.get("severity"), "âšª")
            line_info = f" (è¡Œ {comment.get('line', [0, 0])[0]}-{comment.get('line', [0, 0])[1]})" if comment.get('line') else ""
            
            report += f"{severity_emoji} **{comment.get('severity', '').upper()}**: {comment.get('title', '')}{line_info}\n"
            report += f"  {comment.get('description', '')}\n"
            if comment.get('suggestion'):
                report += f"  **å»ºè®®**: {comment.get('suggestion', '')}\n"
            report += "\n"
    
    # æ€»ç»“å»ºè®®
    report += "## æ€»ç»“å»ºè®®\n\n"
    report += "1. ä¿®å¤æ‰€æœ‰ä¸¥é‡é—®é¢˜ï¼Œç¡®ä¿ä»£ç å®‰å…¨æ€§å’ŒåŠŸèƒ½æ­£ç¡®æ€§\n"
    report += "2. ä¼˜å…ˆå¤„ç†ä¸­ç­‰é—®é¢˜ï¼Œæé«˜ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§\n"
    report += "3. è€ƒè™‘è§£å†³è½»å¾®é—®é¢˜ï¼Œå®Œå–„ä»£ç ç»†èŠ‚\n"
    report += "4. å…³æ³¨ä»£ç è´¨é‡è¯„åˆ†è¾ƒä½çš„æ–‡ä»¶\n"
    report += "5. å®æ–½æ”¹è¿›å»ºè®®ï¼Œæå‡æ•´ä½“ä»£ç è´¨é‡\n\n"
    
    report += "*æœ¬æŠ¥å‘Šç”±AIä»£ç å®¡æŸ¥å·¥å…·è‡ªåŠ¨ç”Ÿæˆã€‚è¯·ç»“åˆäººå·¥åˆ¤æ–­è¿›è¡Œæœ€ç»ˆå†³ç­–ã€‚*"
    
    return report

def main():
    # è®¾ç½®OpenAI APIå¯†é’¥
    openai.api_key = os.environ.get("OPENAI_API_KEY")
    if not openai.api_key:
        print("é”™è¯¯: æœªè®¾ç½®OPENAI_API_KEYç¯å¢ƒå˜é‡")
        sys.exit(1)
    
    # è§£æå‘½ä»¤è¡Œå‚æ•°
    if len(sys.argv) < 2:
        print("ä½¿ç”¨æ–¹æ³•:")
        print("  åˆ†ææäº¤èŒƒå›´: python ai_code_reviewer.py commit-range <commit1>..<commit2>")
        print("  åˆ†ææ–‡ä»¶åˆ—è¡¨: python ai_code_reviewer.py files <file1> <file2> ...")
        print("  åˆ†ææš‚å­˜åŒºæ–‡ä»¶: python ai_code_reviewer.py staged")
        sys.exit(1)
    
    command = sys.argv[1]
    reviews = []
    
    if command == "commit-range" and len(sys.argv) == 4:
        commit_range = f"{sys.argv[2]}..{sys.argv[3]}"
        print(f"æ­£åœ¨åˆ†ææäº¤èŒƒå›´: {commit_range}")
        files = get_changed_files(commit_range)
        
        # è·å–æœ€æ–°æäº¤ä¸­çš„æ–‡ä»¶å†…å®¹
        for file_path in files:
            print(f"æ­£åœ¨åˆ†ææ–‡ä»¶: {file_path}")
            content = get_file_content(file_path, sys.argv[3])
            if content:
                review = analyze_file_with_ai(file_path, content)
                reviews.append(review)
    
    elif command == "files":
        files = sys.argv[2:]
        for file_path in files:
            if not os.path.exists(file_path):
                print(f"è­¦å‘Š: æ–‡ä»¶ä¸å­˜åœ¨ {file_path}")
                continue
            print(f"æ­£åœ¨åˆ†ææ–‡ä»¶: {file_path}")
            content = get_file_content(file_path)
            if content:
                review = analyze_file_with_ai(file_path, content)
                reviews.append(review)
    
    elif command == "staged":
        print("æ­£åœ¨åˆ†ææš‚å­˜åŒºæ–‡ä»¶...")
        # è·å–æš‚å­˜åŒºçš„æ–‡ä»¶åˆ—è¡¨
        try:
            files = subprocess.check_output(
                ["git", "diff", "--staged", "--name-only"],
                universal_newlines=True
            ).strip().split('\n')
            
            for file_path in [f for f in files if f]:
                print(f"æ­£åœ¨åˆ†ææ–‡ä»¶: {file_path}")
                content = get_file_content(file_path)
                if content:
                    review = analyze_file_with_ai(file_path, content)
                    reviews.append(review)
        except subprocess.CalledProcessError as e:
            print(f"è·å–æš‚å­˜åŒºæ–‡ä»¶å¤±è´¥: {e}")
            sys.exit(1)
    
    else:
        print("æ— æ•ˆçš„å‘½ä»¤")
        sys.exit(1)
    
    # ç”Ÿæˆå¹¶æ˜¾ç¤ºæŠ¥å‘Š
    if reviews:
        report = generate_review_report(reviews)
        
        # ä¿å­˜åˆ°æ–‡ä»¶
        report_file = "ai_code_review_report.md"
        with open(report_file, 'w') as f:
            f.write(report)
        
        print(f"\nä»£ç å®¡æŸ¥æŠ¥å‘Šå·²ç”Ÿæˆ: {report_file}")
        print(report)
    else:
        print("æ²¡æœ‰åˆ†æåˆ°ä»»ä½•æ–‡ä»¶")

if __name__ == "__main__":
    main()
```

### å®šåˆ¶åŒ–å®¡æŸ¥è§„åˆ™

ä¸åŒé¡¹ç›®å¯èƒ½æœ‰ä¸åŒçš„ä»£ç è§„èŒƒå’Œå®¡æŸ¥é‡ç‚¹ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•å®šåˆ¶AIå®¡æŸ¥è§„åˆ™çš„ç¤ºä¾‹ï¼š

```python
def create_custom_review_prompt(file_path: str, content: str, custom_rules: List[Dict[str, Any]]) -> str:
    """
    åˆ›å»ºåŒ…å«è‡ªå®šä¹‰å®¡æŸ¥è§„åˆ™çš„æç¤º
    """
    # æ„å»ºè‡ªå®šä¹‰è§„åˆ™æè¿°
    rules_description = "\nè‡ªå®šä¹‰å®¡æŸ¥è§„åˆ™:\n"
    for rule in custom_rules:
        rules_description += f"- {rule['description']}\n"
        if 'importance' in rule:
            rules_description += f"  é‡è¦æ€§: {rule['importance']}\n"
        if 'examples' in rule:
            rules_description += f"  ç¤ºä¾‹: {rule['examples']}\n"
    
    prompt = f"""
è¯·ä½œä¸ºä¸€ä½ç»éªŒä¸°å¯Œçš„ä»£ç å®¡æŸ¥ä¸“å®¶ï¼Œå®¡æŸ¥ä»¥ä¸‹ä»£ç æ–‡ä»¶ï¼Œå¹¶ç‰¹åˆ«æ³¨æ„æˆ‘ä»¬çš„è‡ªå®šä¹‰è§„åˆ™ï¼š

æ–‡ä»¶è·¯å¾„: {file_path}

{rules_description}

ä»£ç å†…å®¹:
```
{content}
```

è¯·æä¾›è¯¦ç»†çš„å®¡æŸ¥æ„è§ï¼Œé‡ç‚¹å…³æ³¨è‡ªå®šä¹‰è§„åˆ™çš„éµå®ˆæƒ…å†µ...
"""
    
    return prompt

# ä½¿ç”¨ç¤ºä¾‹
custom_rules = [
    {
        "description": "ç¦æ­¢åœ¨å¾ªç¯ä¸­ä½¿ç”¨try-catchï¼Œåº”åœ¨å¾ªç¯å¤–å¤„ç†å¼‚å¸¸",
        "importance": "é«˜",
        "examples": "é”™è¯¯ç¤ºä¾‹: for(...) { try { ... } catch(e) { ... } }\næ­£ç¡®ç¤ºä¾‹: try { for(...) { ... } } catch(e) { ... }"
    },
    {
        "description": "æ‰€æœ‰å‡½æ•°å¿…é¡»æœ‰æ˜ç¡®çš„è¿”å›ç±»å‹æ³¨é‡Š",
        "importance": "ä¸­"
    },
    {
        "description": "é¿å…ä½¿ç”¨é­”æ³•æ•°å­—ï¼Œåº”å®šä¹‰ä¸ºå¸¸é‡",
        "importance": "ä¸­"
    }
]

# ä½¿ç”¨è‡ªå®šä¹‰è§„åˆ™åˆ›å»ºæç¤º
prompt = create_custom_review_prompt(file_path, content, custom_rules)
```

### æŒç»­é›†æˆä¸­çš„ä»£ç å®¡æŸ¥

å°†AIä»£ç å®¡æŸ¥é›†æˆåˆ°CI/CDæµç¨‹ä¸­ï¼Œå¯ä»¥åœ¨æ¯æ¬¡ä»£ç æäº¤æˆ–PRæ—¶è‡ªåŠ¨è¿›è¡Œå®¡æŸ¥ï¼š

```yaml
# GitLab CI é…ç½®ç¤ºä¾‹

stages:
  - test
  - review
  - build
  - deploy

# AIä»£ç å®¡æŸ¥ä½œä¸š
ai_code_review:
  stage: review
  image: python:3.10
  before_script:
    - pip install openai
    - git config --global user.email "ci-bot@example.com"
    - git config --global user.name "CI Bot"
  script:
    # è·å–ä¸ä¸»åˆ†æ”¯çš„å·®å¼‚
    - git fetch origin main
    - python scripts/ai_code_reviewer.py commit-range origin/main HEAD > review_report.md
    
    # æ£€æŸ¥æ˜¯å¦æœ‰ä¸¥é‡é—®é¢˜
    - |
      if grep -q "ğŸ”´ CRITICAL" review_report.md; then
        echo "å‘ç°ä¸¥é‡ä»£ç é—®é¢˜ï¼Œè¯·ä¿®å¤åå†æäº¤"
        cat review_report.md
        exit 1
      fi
    
    # ç”Ÿæˆä»£ç å®¡æŸ¥è¯„è®º
    - python scripts/post_review_comments.py
  artifacts:
    paths:
      - review_report.md
  rules:
    - if: $CI_PIPELINE_SOURCE == 'merge_request_event'
```

## 6.2.4 ç‰ˆæœ¬æ§åˆ¶æœ€ä½³å®è·µé›†æˆ

å°†AIä¸ç‰ˆæœ¬æ§åˆ¶æœ€ä½³å®è·µç»“åˆï¼Œå¯ä»¥è‡ªåŠ¨åŒ–ä¸€äº›ç‰ˆæœ¬æ§åˆ¶ç›¸å…³çš„ä»»åŠ¡ï¼Œç¡®ä¿å›¢é˜Ÿéµå¾ªä¸€è‡´çš„å·¥ä½œæµç¨‹ã€‚

### åˆ†æ”¯ç­–ç•¥è‡ªåŠ¨åŒ–

AIå¯ä»¥å¸®åŠ©è‡ªåŠ¨åŒ–åˆ†æ”¯å‘½åå’Œç®¡ç†ï¼Œç¡®ä¿éµå¾ªå›¢é˜Ÿçš„åˆ†æ”¯å‘½åè§„èŒƒï¼š

```python
def generate_branch_name(feature_description: str, team_convention: str = "feature") -> str:
    """
    æ ¹æ®åŠŸèƒ½æè¿°å’Œå›¢é˜Ÿè§„èŒƒç”Ÿæˆåˆé€‚çš„åˆ†æ”¯åç§°
    """
    prompt = f"""
è¯·æ ¹æ®ä»¥ä¸‹åŠŸèƒ½æè¿°å’Œå›¢é˜Ÿåˆ†æ”¯å‘½åè§„èŒƒï¼Œç”Ÿæˆä¸€ä¸ªåˆé€‚çš„Gitåˆ†æ”¯åç§°ã€‚

åŠŸèƒ½æè¿°: {feature_description}

å›¢é˜Ÿå‘½åè§„èŒƒ: {team_convention}

å¸¸è§çš„å›¢é˜Ÿè§„èŒƒæ ¼å¼åŒ…æ‹¬ï¼š
1. feature/descriptionï¼ˆé»˜è®¤ï¼‰
2. bugfix/description
3. hotfix/description
4. chore/description
5. feature/ticket-number-description

è¯·ç”Ÿæˆä¸€ä¸ªç®€æ´ã€æè¿°æ€§å¼ºä¸”ç¬¦åˆè§„èŒƒçš„åˆ†æ”¯åç§°ã€‚
åˆ†æ”¯åç§°åº”è¯¥ï¼š
- ä½¿ç”¨å°å†™å­—æ¯
- ç”¨è¿å­—ç¬¦(-)ä»£æ›¿ç©ºæ ¼
- é¿å…ç‰¹æ®Šå­—ç¬¦
- é•¿åº¦é€‚ä¸­ï¼ˆä¸è¶…è¿‡40ä¸ªå­—ç¬¦ï¼‰
- èƒ½å¤Ÿæ¸…æ™°è¡¨è¾¾åˆ†æ”¯çš„ç›®çš„

è¯·ç›´æ¥æä¾›åˆ†æ”¯åç§°ï¼Œä¸è¦æ·»åŠ ä»»ä½•å…¶ä»–è§£é‡Šã€‚
"""
    
    # è°ƒç”¨AI APIç”Ÿæˆåˆ†æ”¯åç§°
    # ...

# ä½¿ç”¨ç¤ºä¾‹
def main():
    feature_description = input("è¯·è¾“å…¥åŠŸèƒ½æè¿°: ")
    team_convention = input("è¯·è¾“å…¥å›¢é˜Ÿåˆ†æ”¯å‘½åè§„èŒƒ(é»˜è®¤ä¸ºfeature/description): ") or "feature"
    
    branch_name = generate_branch_name(feature_description, team_convention)
    print(f"\nå»ºè®®çš„åˆ†æ”¯åç§°: {branch_name}")
    
    # å¯é€‰ï¼šè‡ªåŠ¨åˆ›å»ºåˆ†æ”¯
    create_branch = input("æ˜¯å¦è‡ªåŠ¨åˆ›å»ºæ­¤åˆ†æ”¯? (y/n): ")
    if create_branch.lower() == 'y':
        try:
            subprocess.run(["git", "checkout", "-b", branch_name], check=True)
            print(f"åˆ†æ”¯ {branch_name} å·²åˆ›å»ºå¹¶åˆ‡æ¢æˆåŠŸ")
        except subprocess.CalledProcessError as e:
            print(f"åˆ›å»ºåˆ†æ”¯å¤±è´¥: {e}")
```

### åˆå¹¶å†²çªæ™ºèƒ½è§£å†³

AIå¯ä»¥å¸®åŠ©è‡ªåŠ¨è§£å†³ä¸€äº›å¸¸è§çš„åˆå¹¶å†²çªï¼š

```python
def resolve_merge_conflicts(file_path: str) -> str:
    """
    ä½¿ç”¨AIæ™ºèƒ½è§£å†³åˆå¹¶å†²çª
    """
    try:
        # è¯»å–åŒ…å«å†²çªæ ‡è®°çš„æ–‡ä»¶å†…å®¹
        with open(file_path, 'r') as f:
            content = f.read()
        
        prompt = f"""
è¯·å¸®æˆ‘è§£å†³ä»¥ä¸‹Gitåˆå¹¶å†²çªï¼š

æ–‡ä»¶è·¯å¾„: {file_path}

å†²çªå†…å®¹:
```
{content}
```

è¯·ä»”ç»†åˆ†æå†²çªçš„ä»£ç ï¼Œå°è¯•æ™ºèƒ½åˆå¹¶åŒæ–¹çš„æ›´æ”¹ã€‚
åœ¨è§£å†³å†²çªæ—¶ï¼Œè¯·ï¼š
1. ä¿ç•™åŒæ–¹çš„å…³é”®æ›´æ”¹
2. é¿å…é‡å¤ä»£ç 
3. ç¡®ä¿åˆå¹¶åçš„ä»£ç è¯­æ³•æ­£ç¡®ä¸”åŠŸèƒ½å®Œæ•´
4. ä¿æŒä»£ç é£æ ¼ä¸€è‡´
5. ä¸è¦æ·»åŠ ä»»ä½•é¢å¤–çš„æ³¨é‡Šè¯´æ˜

è¯·ç›´æ¥æä¾›è§£å†³å†²çªåçš„å®Œæ•´ä»£ç ï¼Œä¸è¦æ·»åŠ å…¶ä»–è§£é‡Šã€‚
"""
        
        # è°ƒç”¨AI APIè§£å†³å†²çª
        # ...
        
        return resolved_content
    except Exception as e:
        print(f"è§£å†³å†²çªå¤±è´¥: {e}")
        return None

# ä½¿ç”¨ç¤ºä¾‹
def main():
    # æŸ¥æ‰¾æ‰€æœ‰åŒ…å«å†²çªæ ‡è®°çš„æ–‡ä»¶
    try:
        conflict_files = subprocess.check_output(
            ["git", "diff", "--name-only", "--diff-filter=U"],
            universal_newlines=True
        ).strip().split('\n')
        
        conflict_files = [f for f in conflict_files if f]
        
        if not conflict_files:
            print("æ²¡æœ‰å‘ç°åˆå¹¶å†²çª")
            return
        
        print(f"å‘ç° {len(conflict_files)} ä¸ªå†²çªæ–‡ä»¶:")
        for i, file_path in enumerate(conflict_files, 1):
            print(f"{i}. {file_path}")
        
        # é€ä¸ªè§£å†³å†²çª
        for file_path in conflict_files:
            print(f"\næ­£åœ¨å°è¯•è§£å†³ {file_path} çš„å†²çª...")
            resolved_content = resolve_merge_conflicts(file_path)
            
            if resolved_content:
                # å†™å…¥è§£å†³åçš„å†…å®¹
                with open(file_path, 'w') as f:
                    f.write(resolved_content)
                
                # æ ‡è®°æ–‡ä»¶ä¸ºå·²è§£å†³
                subprocess.run(["git", "add", file_path], check=True)
                print(f"âœ“ {file_path} å†²çªå·²è§£å†³å¹¶æ·»åŠ åˆ°æš‚å­˜åŒº")
            else:
                print(f"âœ— {file_path} å†²çªæ— æ³•è‡ªåŠ¨è§£å†³ï¼Œè¯·æ‰‹åŠ¨å¤„ç†")
        
        print("\nå†²çªè§£å†³è¿‡ç¨‹å®Œæˆ")
        print("è¯·æ£€æŸ¥è§£å†³æ–¹æ¡ˆåä½¿ç”¨ 'git commit' å®Œæˆåˆå¹¶")
        
    except subprocess.CalledProcessError as e:
        print(f"æ‰§è¡ŒGitå‘½ä»¤å¤±è´¥: {e}")
```

### ä»£ç å†å²åˆ†æä¸æ´å¯Ÿ

AIå¯ä»¥åˆ†æä»£ç åº“çš„å†å²ï¼Œæä¾›æœ‰å…³é¡¹ç›®æ¼”å˜çš„æ´å¯Ÿï¼š

```python
def analyze_repository_evolution(days: int = 30) -> Dict[str, Any]:
    """
    åˆ†æä»£ç åº“åœ¨è¿‡å»æŒ‡å®šå¤©æ•°å†…çš„æ¼”å˜
    """
    try:
        # è·å–æäº¤å†å²ç»Ÿè®¡
        commits_stats = subprocess.check_output(
            ["git", "log", f"--since={days}.days", "--pretty=format:%H|%an|%ae|%at|%s", "--stat"],
            universal_newlines=True
        )
        
        # è·å–åˆ†æ”¯æ´»åŠ¨
        branches_info = subprocess.check_output(
            ["git", "branch", "-v"],
            universal_newlines=True
        )
        
        # è·å–è´¡çŒ®è€…ç»Ÿè®¡
        contributors = subprocess.check_output(
            ["git", "shortlog", "-sn", f"--since={days}.days"],
            universal_newlines=True
        )
        
        prompt = f"""
è¯·åˆ†æä»¥ä¸‹Gitä»“åº“æ•°æ®ï¼Œå¹¶æä¾›å…³äºé¡¹ç›®æ¼”å˜çš„æ´å¯Ÿå’Œå»ºè®®ï¼š

1. è¿‡å»{days}å¤©çš„æäº¤å†å²ç»Ÿè®¡ï¼š
```
{commits_stats}
```

2. å½“å‰åˆ†æ”¯ä¿¡æ¯ï¼š
```
{branches_info}
```

3. è´¡çŒ®è€…ç»Ÿè®¡ï¼š
```
{contributors}
```

è¯·æä¾›ä»¥ä¸‹å†…å®¹ï¼š
1. é¡¹ç›®æ´»åŠ¨æ‘˜è¦å’Œè¶‹åŠ¿åˆ†æ
2. å…³é”®è´¡çŒ®è€…å’Œä»–ä»¬çš„ä¸»è¦å·¥ä½œé¢†åŸŸ
3. å¯èƒ½çš„é¡¹ç›®å¥åº·çŠ¶å†µæŒ‡æ ‡
4. åˆ†æ”¯ç®¡ç†å’Œåˆå¹¶ç­–ç•¥çš„è¯„ä¼°
5. æ½œåœ¨çš„æ”¹è¿›å»ºè®®

è¯·ä½¿ç”¨ä¸“ä¸šä½†å‹å¥½çš„è¯­è¨€ï¼Œæ³¨é‡æä¾›æœ‰ä»·å€¼çš„æ´å¯Ÿè€Œéç®€å•çš„æ•°æ®å¤è¿°ã€‚
"""
        
        # è°ƒç”¨AI APIç”Ÿæˆåˆ†ææŠ¥å‘Š
        # ...
        
    except Exception as e:
        print(f"åˆ†æä»“åº“æ¼”å˜å¤±è´¥: {e}")
        return None
```

## æ€»ç»“

æœ¬æœŸæˆ‘ä»¬æ·±å…¥æ¢è®¨äº†ç‰ˆæœ¬æ§åˆ¶ä¸AIçš„ç»“åˆåº”ç”¨ï¼ŒåŒ…æ‹¬AIè¾…åŠ©çš„æäº¤ä¿¡æ¯ç”Ÿæˆã€æ™ºèƒ½ä»£ç å·®å¼‚åˆ†æã€è‡ªåŠ¨åŒ–ä»£ç å®¡æŸ¥æµç¨‹ä»¥åŠç‰ˆæœ¬æ§åˆ¶æœ€ä½³å®è·µé›†æˆã€‚

é€šè¿‡å°†AIé›†æˆåˆ°ç‰ˆæœ¬æ§åˆ¶æµç¨‹ä¸­ï¼Œæ‚¨å¯ä»¥æ˜¾è‘—æé«˜å¼€å‘æ•ˆç‡ã€ç¡®ä¿ä»£ç è´¨é‡ä¸€è‡´æ€§ã€è‡ªåŠ¨åŒ–å¸¸è§„ä»»åŠ¡ï¼Œå¹¶è·å¾—å¯¹ä»£ç åº“æ¼”å˜çš„æ›´æ·±å…¥æ´å¯Ÿã€‚åœ¨ä¸‹ä¸€æœŸä¸­ï¼Œæˆ‘ä»¬å°†ç»§ç»­æ¢è®¨å¦‚ä½•ä½¿ç”¨AIç”Ÿæˆæ–‡æ¡£ï¼Œä»ä»£ç åˆ°çŸ¥è¯†åº“çš„è½¬åŒ–ï¼Œæ•¬è¯·æœŸå¾…ï¼

## æ€è€ƒä¸ç»ƒä¹ 

1. å°è¯•åˆ›å»ºä¸€ä¸ªAIè¾…åŠ©çš„Gitæäº¤ä¿¡æ¯ç”Ÿæˆå·¥å…·ï¼Œå¹¶é›†æˆåˆ°æ‚¨çš„å¼€å‘å·¥ä½œæµä¸­ã€‚

2. è®¾è®¡ä¸€ä¸ªè‡ªå®šä¹‰çš„ä»£ç å®¡æŸ¥è§„åˆ™é›†ï¼Œé’ˆå¯¹æ‚¨å›¢é˜Ÿçš„ç‰¹å®šéœ€æ±‚ã€‚

3. æ€è€ƒå¦‚ä½•å°†AIä»£ç å®¡æŸ¥å·¥å…·é›†æˆåˆ°æ‚¨ç°æœ‰çš„CI/CDæµç¨‹ä¸­ã€‚

4. åˆ†ææ‚¨é¡¹ç›®çš„Gitå†å²ï¼Œä½¿ç”¨AIè·å–æœ‰å…³é¡¹ç›®æ¼”å˜çš„æ´å¯Ÿã€‚

---

*æœ¬æ•™ç¨‹å°†æŒç»­æ›´æ–°ï¼Œè·Ÿè¿›AIç¼–ç¨‹é¢†åŸŸçš„æœ€æ–°å‘å±•ä¸æœ€ä½³å®è·µã€‚*